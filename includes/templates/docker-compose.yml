version: '3'

services:
  npm:
    image: 'jc21/nginx-proxy-manager:latest'
    container_name: nginx-proxy-manager
    restart: unless-stopped
    ports:
      - 80:80
      - 81:81
      - 443:443
    volumes:
      - {{APP_SETTINGS_DIR}}/nginx-proxy-manager/data:/data
      - {{APP_SETTINGS_DIR}}/nginx-proxy-manager/letsencrypt:/etc/letsencrypt
    networks:
      mon-reseau:
        ipv4_address: 172.18.0.2 # Adresse IP statique pour nginx-proxy-manager

  portainer:
    image: portainer/portainer-ce
    container_name: portainer-ce
    restart: unless-stopped
    volumes: 
      - /var/run/docker.sock:/var/run/docker.sock
      - {{APP_SETTINGS_DIR}}/portainer:/data
    ports:
      - 9000:9000
    networks:
      mon-reseau:
        ipv4_address: 172.18.0.3 # Adresse IP statique pour portainer-ce

  plex:
    image: lscr.io/linuxserver/plex:latest
    container_name: plex
    environment:
      - VERSION=docker
      - PUID=1000
      - PGID=1000
      - PLEX_CLAIM={{PLEX_CLAIM}}
      - TZ=Europe/Paris
    ports:
      - 32400:32400
    volumes:
      - {{APP_SETTINGS_DIR}}/plex/config:/config
      - {{APP_SETTINGS_DIR}}/plex/transcode:/transcode
      - {{RCLONE_DIR}}:/rclone
    restart: unless-stopped
    network_mode: bridge

  rdtclient:
    container_name: rdtclient
    volumes:
      - '{{USER_HOME}}/local/:/data/downloads'
      - '{{APP_SETTINGS_DIR}}/rdt-client/:/data/db'
    image: rogerfar/rdtclient
    restart: always
    logging:
      driver: json-file
      options:
        max-size: 10m
    ports:
      - '6500:6500'
    networks:
      mon-reseau:
        ipv4_address: 172.18.0.4 # Adresse IP statique pour nginx-proxy-manager
        
  overseerr:
    image: lscr.io/linuxserver/overseerr
    container_name: overseerr
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Europe/Paris
      - VERSION=latest
    volumes:
      - {{APP_SETTINGS_DIR}}/overseerr/config:/config
    ports:
      - 5055:5055
    restart: unless-stopped
    networks:
      mon-reseau:
        ipv4_address: 172.18.0.5 # Adresse IP statique pour overseerr

  tautulli:
    image: lscr.io/linuxserver/tautulli
    container_name: tautulli
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Europe/Paris
    volumes:
      - {{APP_SETTINGS_DIR}}/tautulli/config:/config
    ports:
      - 8181:8181
    restart: unless-stopped
    networks:
      mon-reseau:
        ipv4_address: 172.18.0.6 # Adresse IP statique pour tautulli

  jackett:
    image: lscr.io/linuxserver/jackett:latest
    container_name: jackett
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Europe/Paris        
    volumes:
      - {{APP_SETTINGS_DIR}}/jackett/config:/config
      - {{APP_SETTINGS_DIR}}/jackett/blackhole/:/downloads   
    ports:
      - 9117:9117      
    restart: unless-stopped
    networks:
      mon-reseau:
        ipv4_address: 172.18.0.7 # Adresse IP statique pour jackett

  prowlarr:
    image: lscr.io/linuxserver/prowlarr:latest
    container_name: prowlarr
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Europe/Paris 
    volumes:
      - {{APP_SETTINGS_DIR}}/prowlarr/config:/config
    ports:
      - 9696:9696
    restart: unless-stopped
    networks:
      mon-reseau:
        ipv4_address: 172.18.0.8 # Adresse IP statique pour prowlarr

  flaresolverr:
    image: ghcr.io/flaresolverr/flaresolverr:latest
    container_name: flaresolverr
    security_opt:
      - no-new-privileges:true    
    environment:
      - TZ=Europe/Paris  
      - LOG_LEVEL=${LOG_LEVEL:-info}
      - LOG_HTML=${LOG_HTML:-false}      
      - CAPTCHA_SOLVER=${CAPTCHA_SOLVER:-none}       
    restart: unless-stopped
    networks:
      mon-reseau:
        ipv4_address: 172.18.0.9 # Adresse IP statique pour flaresolverr

  wireguard:
    image: linuxserver/wireguard:latest
    container_name: wireguard
    cap_add:
      - NET_ADMIN
      - SYS_MODULE
    environment:
      - TZ=Europe/Paris
    volumes:
      - {{APP_SETTINGS_DIR}}/wireguard/config:/config
    sysctls:
      - net.ipv4.conf.all.src_valid_mark=1
    #ports:
      #- 51820:51820/udp
    restart: unless-stopped
    networks:
      mon-reseau:
        ipv4_address: 172.18.0.10 # Adresse IP statique pour wireguard
  sonarr:
    image: lscr.io/linuxserver/sonarr:latest
    container_name: sonarr
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Europe/Paris
    volumes:
      - {{APP_SETTINGS_DIR}}/sonarr/:/config
      - {{USER_HOME}}:/{{USER_HOME}}
    ports:
      - 8989:8989
    restart: unless-stopped
    networks:
      mon-reseau:
        ipv4_address: 172.18.0.11 # Adresse IP statique pour sonarr

  radarr:
    image: lscr.io/linuxserver/radarr:latest
    container_name: radarr
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Europe/Paris
    volumes:
      - {{APP_SETTINGS_DIR}}/radarr/:/config
      - {{USER_HOME}}:/{{USER_HOME}}
    ports:
      - 7878:7878
    restart: unless-stopped
    networks:
      mon-reseau:
        ipv4_address: 172.18.0.12 # Adresse IP statique pour radarr

  filebot-node:
    container_name: filebot-node
    image: rednoah/filebot:node
    restart: unless-stopped
    volumes:
      - {{USER_HOME}}/filebot/:/data:rw
      - {{RCLONE_DIR}}:/volume1/rclone/:rw
      - {{MEDIAS_DIR}}:/volume1/output/:rw
    ports:
      - 5452:5452
    environment:
      - PUID=1000
      - PGID=1000
    networks:
      mon-reseau:
        ipv4_address: 172.18.0.13 # Adresse IP statique pour filebot-node
        
  watchtower:
    image: containrrr/watchtower
    container_name: watchtower
    restart: unless-stopped
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    environment:
      TZ: "Europe/Paris"
      WATCHTOWER_CLEANUP: "true"
      WATCHTOWER_NO_STARTUP_MESSAGE: "true"
      WATCHTOWER_SCHEDULE: "0 0 4 * * *"
    networks:
      mon-reseau:
        ipv4_address: 172.18.0.30 # Adresse IP statique pour watchtower

networks:
  mon-reseau:
    driver: bridge
    ipam:
      config:
        - subnet: 172.18.0.0/16
